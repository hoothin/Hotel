<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>回访任务</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../lib/layui-v2.5.4/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
</head>

<body>
    <div class="layuimini-container">
        <div class="layuimini-main">
            <fieldset class="layui-elem-field layuimini-search">
                <legend>回访任务</legend>
                <div style="margin: 10px 10px 10px 10px">
                    <form class="layui-form layui-form-pane" action="">
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label">任务名称</label>
                                <div class="layui-input-inline" style="width: 300px;">
                                    <input type="text" name="taskName" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">创建日期</label>
                                <div class="layui-input-inline" style="width: 200px;">
                                    <input type="text" class="layui-input" name="addDate" placeholder="">
                                </div>
                            </div>
                            <div class="layui-inline">
                                <a class="layui-btn" lay-submit="" lay-filter="data-search-btn">搜索</a>
                            </div>
                    </form>
                    </div>
            </fieldset>
            <div class="layui-btn-group">
                <button class="layui-btn data-add-btn ">创建任务</button>
                <button class="layui-btn layui-btn-danger data-delete-btn">删除</button>
            </div>
            <table class="layui-hide" id="currentTableId" lay-filter="currentTableFilter"></table>
            <script type="text/html" id="currentTableBar">
                <a class="layui-btn layui-btn-xs data-count-edit" lay-event="edit">任务处理</a>
                <a class="layui-btn layui-btn-xs layui-btn-danger data-count-delete" lay-event="delete">删除</a>
            </script>
            </div>
        </div>
        <script src="../lib/layui-v2.5.4/layui.js" charset="utf-8"></script>
        <script>
        layui.use('laydate', function() {
            var laydate = layui.laydate;

            //执行一个laydate实例
            laydate.render({ elem: '#test1', trigger: 'click', type: 'date' }); //指定元素

        });
        </script>
        <script>
        layui.use(['form', 'table'], function() {
            var $ = layui.jquery,
                form = layui.form,
                table = layui.table;

            table.render({
                elem: '#currentTableId',
                url: '/admin/?p=index&searchTaskList=1',
                cols: [
                    [
                        { type: "checkbox", width: 50, fixed: "left" },
                        { field: 'addTime', width: 120, title: '创建时间' },
                        { field: 'taskName', width: 400, title: '任务名称' },
                        { field: 'allTaskNum', width: 100, title: '任务条数' },
                        { field: 'doneTaskNum', width: 100, title: '已完成' },
                        { field: 'undoneTaskNum', width: 100, title: '未完成' },
                        { title: '操作', minWidth: 50, templet: '#currentTableBar', fixed: "right", align: "center" }
                    ]
                ],
                limits: [10, 15, 20, 25, 50, 100],
                limit: 15,
                page: true
            });

            // 监听搜索操作
            form.on('submit(data-search-btn)', function(data) {
                var result = JSON.stringify(data.field);

                //执行搜索重载
                table.reload('currentTableId', {
                    page: {
                        curr: 1
                    },
                    where: {
                        searchParams: result
                    }
                }, 'data');

                return false;
            });

            // 监听添加操作
            $(".data-add-btn").on("click", function() {
                window.location.href = "hf-form.html"

            });

            // 监听删除操作
            $(".data-delete-btn").on("click", function() {
                var checkStatus = table.checkStatus('currentTableId'),
                    data = checkStatus.data;
                layer.alert(JSON.stringify(data));
            });

            //监听表格复选框选择
            table.on('checkbox(currentTableFilter)', function(obj) {
                console.log(obj)
            });

            table.on('tool(currentTableFilter)', function(obj) {
                var data = obj.data;
                if (obj.event === 'edit') {
                    window.location.href = "hf-table-edit.html#/id="+data.id;
                } else if (obj.event === 'delete') {
                    layer.confirm('真的删除当前行么', function(index) {
                        $.get("/admin/?p=index&delTask=1&taskListId="+data.id, function(result){
                            if(result==1){
                                obj.del();
                                layer.alert("删除成功");
                            }
                            layer.close(index);
                        });
                    });
                }
            });

        });
        </script>
        <script>
        </script>
</body>

</html>