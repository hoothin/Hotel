<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>创建任务</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../lib/layui-v2.5.4/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
    <link rel="stylesheet" href="../lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
</head>

<body>
    <div class="layuimini-container">
        <div class="layuimini-main">
            <button type="button" class="layui-btn layui-btn-danger data-add-cancel "><i class="fa fa-remove icon"></i>取消添加</button>
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>创建新任务</legend>
            </fieldset>
            <form class="layui-form" action="">
                <div class="layui-form-item">
                    <label class="layui-form-label required">任务名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="taskName" lay-verify="required" autocomplete="off" placeholder="请输入任务名称" class="layui-input">
                    </div>
                </div>
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                </fieldset>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">注册时间</label>
                        <div class="layui-input-inline" style="width: 200px;">
                            <input type="text" name="regTimeStart" class="layui-input" id="test1" lay-verify="" placeholder="yyyy-MM-dd HH:mm:ss">
                        </div>
                        <div class="layui-form-mid">- </div>
                        <div class="layui-input-inline" style="width: 200px;">
                            <input type="text" name="regTimeEnd" class="layui-input" id="test2" placeholder="yyyy-MM-dd HH:mm:ss">
                        </div>
                    </div>
                </div>
                
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label" style="">年龄区间</label>
                        <div class="layui-input-inline" style="width:100px;">
                            <input type="text" name="age_min" placeholder="最小年龄" autocomplete="off" class="layui-input">
                        </div>
                        <div class="layui-form-mid">-</div>
                        <div class="layui-input-inline" style="width: 100px;">
                            <input type="text" name="age_max" placeholder="最大年龄" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label" style="width:auto;">会员性别</label>
                        <div class="layui-input-block" style="width:120px;">
                            <select name="sex" lay-filter="sex">
                                <option value="">不限</option>
                                <option value="1">男</option>
                                <option value="2">女</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">预订次数</label>
                        <div class="layui-input-inline" style="width:100px;">
                            <input type="text" name="order_min" placeholder="0" autocomplete="off" class="layui-input">
                        </div>
                        <div class="layui-form-mid">-</div>
                        <div class="layui-input-inline" style="width: 100px;">
                            <input type="text" name="order_max" placeholder="10" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label" style="width:auto;">卡片类型</label>
                        <div class="layui-input-block" style="width: 120px;">
                            <select name="cardType" lay-filter="">
                                <option value="">不限</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit="" lay-filter="demo1">创建任务</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script src="../lib/layui-v2.5.4/layui.js" charset="utf-8"></script>
    <!-- 日期选择器 -->
    <script>
    layui.use('laydate', function() {
        var laydate = layui.laydate;
        //执行一个laydate实例
        laydate.render({ elem: '#test1', trigger: 'click', type: 'datetime' }); //指定元素
        laydate.render({ elem: '#test2', trigger: 'click', type: 'datetime' });

    });
    </script>
    <!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
    <script>
    layui.use(['form', 'layedit', 'laydate'], function() {
        var $ = layui.jquery,
            form = layui.form,
            layer = layui.layer,
            layedit = layui.layedit,
            laydate = layui.laydate;


        //自定义验证规则
        form.verify({
            title: function(value) {
                if (value.length < 1) {
                    return '任务名称不能为空';
                }
            },
            pass: [
                /^[\S]{6,12}$/, '密码必须6到12位，且不能出现空格'
            ],
            content: function(value) {
                layedit.sync(editIndex);
            }
        });


        //监听提交
        form.on('submit(demo1)', function(data) {
            layer.alert(JSON.stringify(data.field), {
                title: '最终的提交信息'
            })
            //{"taskName":"","regTimeStart":"","regTimeEnd":"","province":"","city":"","county":"","age_min":"","age_max":"","sex":"","order_min":"","order_max":"","cardType":""}
            $.post("/admin/?p=index&addTask=1",{
                taskName:data.field.taskName,
                regTimeStart:data.field.regTimeStart,
                regTimeEnd:data.field.regTimeEnd,
                province:data.field.province,
                city:data.field.city,
                county:data.field.county,
                age_min:data.field.age_min,
                age_max:data.field.age_max,
                sex:data.field.sex,
                order_min:data.field.order_min,
                order_max:data.field.order_max,
                cardType:data.field.cardType
            }, function(result){
                if(result==1){
                    layer.alert("创建成功", {
                        title: '成功'
                    },function (index) { 
                        location.href="hf-table.html";
                    });
                    
                }
            });
            return false;
        });



        //监听取消添加

        $(".data-add-cancel").on("click", function() {
            window.location.href = "hf-table.html";

        });

        $.get("/admin/?p=index&getCards=1", function(result){
            var cards=JSON.parse(result);
            for(i in cards){
                var card=cards[i];
                $("select[name=cardType]").append('<option value="'+card["type"]+'">'+card["cardName"]+'</option>');
            }
            layui.use('form', function() {
                var form = layui.form;
                form.render();
            });
        });

    });
    </script>
</body>

</html>