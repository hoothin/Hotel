<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>结算详情</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../lib/layui-v2.5.4/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
    <style>
    .layui-card {
        margin-bottom: 15px;
        background-color: rgb(255, 255, 255);
        box-shadow: rgba(0, 0, 0, 0.05) 0px 0px 0px 0px;
        border-radius: 2px;
    }

    .pull-right {
        float: right;
    }

    .welcome-module {
        width: 100%;
        height: 70px;
    }

    .panel-body {
        padding: 10px;
    }

    .layui-bg-number {
        background-color: #F8F8F8;
    }

    .layui-card-body {
        position: relative;
        padding: 10px 15px;
        line-height: 24px;
    }

    .layui-card-header {
        position: relative;
        height: 42px;
        line-height: 42px;
        padding: 0 15px;
        color: #333;
        border-radius: 2px 2px 0 0;
        font-size: 14px;
    }

    .panel {
        background-color: #fff;
        border-radius: 3px;

        box-shadow: 0 1px 1px rgba(0, 0, 0, .05);
    }

    .layui-bg-number {
        background-color: #F8F8F8;
    }

    .label {
        display: inline;
        padding: .2em .6em .3em;
        font-size: 75%;
        font-weight: 700;
        line-height: 1;
        color: #fff;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: .25em;
        margin-top: .3em;
    }

    .layui-col-xs3 {

        padding: 5px;
    }
    </style>
</head>

<body>
    <div class="layuimini-container">
        <div class="layuimini-main">
            <fieldset class="layui-elem-field layuimini-search">
                <legend>结算详情</legend>
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="welcome-module">
                            <div class="layui-row layui-col-md12">
                                <div class="layui-col-xs3">
                                    <div class="panel layui-bg-number">
                                        <div class="panel-body">
                                            <div class="panel-title">
                                                <span class="label pull-right layui-bg-cyan">实时</span>
                                                <h5>成交总额</h5>
                                            </div>
                                            <div class="panel-content">
                                                <h1 class="no-margins needPay">¥</h1>
                                                <small></small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="layui-col-xs3">
                                    <div class="panel layui-bg-number">
                                        <div class="panel-body">
                                            <div class="panel-title">
                                                <span class="label pull-right layui-bg-orange">实时</span>
                                                <h5>支付总额</h5>
                                            </div>
                                            <div class="panel-content">
                                                <h1 class="no-margins paid">¥</h1>
                                                <small></small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="layui-col-xs3">
                                    <div class="panel layui-bg-number">
                                        <div class="panel-body">
                                            <div class="panel-title">
                                                <span class="label pull-right layui-bg-green">实时</span>
                                                <h5>支付结余</h5>
                                            </div>
                                            <div class="panel-content">
                                                <h1 class="no-margins paymore">¥</h1>
                                                <small></small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin: 10px 0px 0px 1px;"></div>
                </div>
            </fieldset>
            <div style="margin: 20px 0px 0px 1px;"></div>
            <form class="layui-form" action="">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label" style="width: 100px;">结算时段选择</label>
                        <div class="layui-input-inline" style="width: 200px;">
                            <input type="text" name="startTime" class="layui-input" id="test1" placeholder="yyyy-MM-dd HH:mm:ss">
                        </div>
                        <div class="layui-form-mid">- </div>
                        <div class="layui-input-inline" style="width: 200px;">
                            <input type="text" name="endTime" class="layui-input" id="test2" placeholder="yyyy-MM-dd HH:mm:ss">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <a class="layui-btn" lay-submit="" lay-filter="data-search-btn">搜索</a>
                    </div>
                </div>
            </form>
            <div class="layui-tab" lay-filter="tab-all">
                <ul class="layui-tab-title">
                    <li class="layui-this">结算记录</li>
                    <li>消费明细</li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">
                        <table class="layui-hide" id="jsjl" lay-filter="jsjl"></table>
                    </div>
                    <div class="layui-tab-item">
                        <table class="layui-hide" id="xfmx" lay-filter="xfmx"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/html" id="orderState">
        {{#if (d.state == 0) { }}
         <span>待确认</span>
        {{# }else if(d.state == 1){ }}
        <span>待入住</span>
        {{# }else if(d.state == 2){ }}
        <span>已取消</span>
        {{# }else if(d.state == 3){ }}
        <span>已完成</span>
        {{# }else if(d.state == 4){ }}
        <span>超时未入住</span>
        {{# } }}
    </script>
    <script src="../lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
    <script src="../lib/layui-v2.5.4/layui.js" charset="utf-8"></script>
    <script>
    var router = layui.router(); var id = router.search.id;
    if(!id)id=0;
    $.get("/admin/?p=index&getChannelBillInfo=1&channelId="+id, function(result){
        result=JSON.parse(result);
        $(".paid").html("¥"+result.paid);
        $(".needPay").html("¥"+result.needPay);
        $(".paymore").html("¥"+result.paymore);
    });
    layui.use(['element', 'form', 'table'], function() {
        var $ = layui.jquery,
            form = layui.form,
            table = layui.table;

        //结算记录

        table.render({
            elem: '#jsjl',
            url: '/admin/?p=index&searchChannelBill=1&channelId='+id,
            cols: [
                [
                    { field: 'addTime', width: 240, title: '时间' },
                    { field: 'paid', width: 180, title: '支付', templet: function (d) {return d.billType=="0"?d.billNum:0;}},
                    { field: 'prestore', width: 180, title: '预存', templet: function (d) {return d.billType=="0"?0:d.billNum;}},
                    { field: 'billDesc', title: '打款流水号' }

                ]
            ],
            limits: [10, 15, 20, 25, 50, 100],
            limit: 15,
            page: true
        });

        //消费明细

        table.render({
            elem: '#xfmx',
            url: '/admin/?p=index&searchChannelOrder=1&channelId='+id,
            cols: [
                [
                    { field: 'startTime', width: 240, title: '时间' },
                    { field: 'channelPrice', width: 180, title: '消费金额' },
                    { field: 'usedCard', width: 180, title: '会员卡号' },
                    { field: 'name', width: 180, title: '酒店名称' },
                    { field: 'type', width: 180, title: '客房名称' },
                    { field: 'state', title: '入住状态', templet: "#orderState"},
                ]
            ],
            limits: [10, 15, 20, 25, 50, 100],
            limit: 15,
            page: true
        });

        // 监听搜索操作
        form.on('submit(data-search-btn)', function(data) {
            var result = JSON.stringify(data.field);
            // layer.alert(result, {
            //     title: '最终的搜索信息'
            // });

            //执行搜索重载
            table.reload('jsjl', {
                page: {
                    curr: 1
                },
                where: {
                    searchParams: result
                }
            }, 'data');

            table.reload('xfmx', {
                page: {
                    curr: 1
                },
                where: {
                    searchParams: result
                }
            }, 'data');

            return false;
        });




        //监听按钮操作
        table.on('tool(currentTableFilter)', function(obj) {
            var data = obj.data;
            if (obj.event === 'addfk') {
                //layer.alert('编辑行：<br>' + JSON.stringify(data))
                window.location.href = "fk-form.html"
            } else if (obj.event === 'addzd') {

                window.location.href = "zdxq-table.html"
            }
        });

    });
    </script>
    <!-- 日期选择器 -->
    <script>
    layui.use('laydate', function() {
        var laydate = layui.laydate;

        //执行一个laydate实例
        laydate.render({ elem: '#test1', trigger: 'click', type: 'date' }); //指定元素

        laydate.render({ elem: '#test2', trigger: 'click', type: 'date' });

    });
    </script>
</body>

</html>