<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>账单管理</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../lib/layui-v2.5.4/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
    <style>
    .layui-top-box {
        padding: 10px 10px 10px 10px;
        color: #fff
    }

    .panel {
        margin-bottom: 0px;
        background-color: #fff;
        border: 1px solid transparent;
        border-radius: 3px;
        -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, .05);
        box-shadow: 0 1px 1px rgba(0, 0, 0, .05)
    }

    .panel-body {
        padding: 15px
    }

    .panel-title {
        margin-top: 0;
        margin-bottom: 0;
        font-size: 14px;
        color: inherit
    }

    .label {
        display: inline;
        padding: .2em .6em .3em;
        font-size: 75%;
        font-weight: 700;
        line-height: 1;
        color: #fff;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: .25em;
        margin-top: .3em;
    }

    .layui-red {
        color: red
    }

    .main_btn>p {
        height: 40px;
    }

    .pull-right {
        float: right;
    }
    </style>
</head>

<body>
    <div class="layuimini-container">
        <div class="layuimini-main">
            <fieldset class="layui-elem-field layuimini-search">
                <legend>上月账单总览</legend>
                <div class="layui-top-box">
                    <div class="layui-row layui-col-space10">
                        <div class="layui-col-md4">
                            <div class="col-xs-6 col-md-3">
                                <div class="panel layui-bg-cyan">
                                    <div class="panel-body">
                                        <div class="panel-title">
                                            <span class="label pull-right layui-bg-blue"></span>
                                            <h5>上月消费总金额</h5>
                                        </div>
                                        <div class="panel-content">
                                            <h1 class="no-margins needPay"></h1>
                                            <div class="stat-percent font-bold text-gray"></div>
                                            <small class="lastMonth">2019年9月~10月</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-md4">
                            <div class="col-xs-6 col-md-3">
                                <div class="panel layui-bg-blue">
                                    <div class="panel-body">
                                        <div class="panel-title">
                                            <span class="label pull-right layui-bg-cyan"></span>
                                            <h5>上月已支付总额</h5>
                                        </div>
                                        <div class="panel-content">
                                            <h1 class="no-margins paid"></h1>
                                            <div class="stat-percent font-bold text-gray"></div>
                                            <small class="lastMonth">2019年9月~10月</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-md4">
                            <div class="col-xs-6 col-md-3">
                                <div class="panel layui-bg-red">
                                    <div class="panel-body">
                                        <div class="panel-title">
                                            <span class="label pull-right layui-bg-orange"></span>
                                            <h5>上月支付结余</h5>
                                        </div>
                                        <div class="panel-content">
                                            <h1 class="no-margins paymore"></h1>
                                            <div class="stat-percent font-bold text-gray"></div>
                                            <small class="lastMonth">2019年9月~10月</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
            <div style="margin: 20px 0px 0px 1px;">
                <form class="layui-form layui-form-pane" action="">
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">渠道名称</label>
                            <div class="layui-input-inline">
                                <input type="text" name="channelName" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <a class="layui-btn" lay-submit="" lay-filter="data-search-btn">搜索</a>
                        </div>
                    </div>
                </form>
            </div>
            <table class="layui-hide" id="currentTableId" lay-filter="currentTableFilter"></table>
            <script type="text/html" id="currentTableBar">
                <a class="layui-btn layui-btn-xs data-add-fk" lay-event="addfk">付款记账</a>
                <a class="layui-btn layui-btn-xs layui-btn-danger data-add-zd" lay-event="addzd">详细账单</a>
            </script>
        </div>
    </div>
    <script src="../lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
    <script src="../lib/layui-v2.5.4/layui.js" charset="utf-8"></script>
    <script>
    function getPreMonth() {
        var now=new Date();
        var year = now.getFullYear();//getYear()+1900=getFullYear()
        var month = now.getMonth() +1;//0-11表示1-12月
        var day = now.getDate();

        var year2=year;
        var month2=parseInt(month) - 1;
        if (month2 == 0) {
            year2 = parseInt(year) - 1;
            month2 = 12;
        }
        var date = year2 + '年' + month2 + '月~' + year+ '年' + month + '月';
        return date;
    }
    var dateStr=getPreMonth();
    $(".lastMonth").html(dateStr);

    layui.use(['form', 'table'], function() {
        var $ = layui.jquery,
            form = layui.form,
            table = layui.table;

        table.render({
            elem: '#currentTableId',
            url: '/admin/?p=index&searchBill=1',
            cols: [
                [
                    { field: 'nickName', width: 240, title: '渠道名称' },
                    { field: 'needPay', width: 180, title: '本月待支付总额' },
                    { field: 'paid', width: 180, title: '本月已支付金额' },
                    { field: 'paymore', width: 180, title: '当前支付结余' },
                    { title: '操作', minWidth: 50, templet: '#currentTableBar', fixed: "right", align: "center" }
                ]
            ],
            limits: [10, 15, 20, 25, 50, 100],
            limit: 15,
            page: true
        });

        // 监听搜索操作
        form.on('submit(data-search-btn)', function(data) {
            var result = JSON.stringify(data.field);

            //执行搜索重载
            table.reload('currentTableId', {
                page: {
                    curr: 1
                },
                where: {
                    searchParams: result
                }
            }, 'data');

            return false;
        });

        $.get("/admin/?p=index&getTotalBill=1", function(result){
            result=JSON.parse(result);
            $(".paid").html("¥"+result.paid);
            $(".needPay").html("¥"+result.needPay);
            $(".paymore").html("¥"+result.paymore);
        });

        //监听按钮操作
        table.on('tool(currentTableFilter)', function(obj) {
            var data = obj.data;
            if (obj.event === 'addfk') {
                //layer.alert('编辑行：<br>' + JSON.stringify(data))
                window.location.href = "fk-form.html#/id="+data.id;
            } else if (obj.event === 'addzd') {
                window.location.href = "zdxq-table.html#/id="+data.id;
            }
        });

    });
    </script>
    <script>
    </script>
</body>

</html>