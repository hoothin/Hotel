<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>系统设置</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../lib/layui-v2.5.4/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
    <link rel="stylesheet" href="../lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
    <link rel="stylesheet" href="../lib/jq-module/zyupload/zyupload-1.0.0.min.css" media="all">
</head>

<body>
    <div class="layuimini-container">
        <div class="layuimini-main">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>系统管理</legend>
            </fieldset>
            <div class="layui-tab" lay-filter="tab-all">
                <ul class="layui-tab-title">
                    <li class="layui-this">网站设置</li>
                    <li>广告管理</li>
                    <li>关于我们</li>
                    <li>客服中心</li>
                    <li>使用规则</li>
                </ul>
                <div class="layui-tab-content">
                    <!--网站设置 -->
                    <div class="layui-tab-item layui-show">
                        <div class="layui-form layuimini-form">
                            <div class="layui-form-item">
                                <label class="layui-form-label required">网站名称</label>
                                <div class="layui-input-block">
                                    <input type="text" name="sitename" lay-verify="required" lay-reqtext="网站域名不能为空" placeholder="请输入网站名称" value="" class="layui-input">
                                    <tip>填写自己部署网站的名称。</tip>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label required">热门城市</label>
                                <div class="layui-input-block">
                                    <input type="text" name="hotCity" lay-verify="hotCity" lay-reqtext="" placeholder="请输入城市名" value="" class="layui-input">
                                    <tip>填写城市名称，以逗号分隔，如“常州市,苏州市”。</tip>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label required">上新酒店</label>
                                <div class="layui-input-block">
                                    <input type="text" name="newHotel" lay-verify="" lay-reqtext="" placeholder="请输入酒店ID" value="" class="layui-input">
                                    <tip>填写酒店ID，以逗号分隔，如“23,45”。</tip>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label required">网站域名</label>
                                <div class="layui-input-block">
                                    <input type="text" name="domain" lay-verify="required" lay-reqtext="网站域名不能为空" placeholder="请输入网站域名" value="1f1p.com" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item layui-form-text">
                                <label class="layui-form-label required">注册协议</label>
                                <div class="layui-input-block">
                                    <textarea name="keywords" class="layui-textarea" placeholder="注册协议"></textarea>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <button class="layui-btn" lay-submit lay-filter="setting">确认保存</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 广告管理 -->
                    <!-- element-ui-js库 -->
                    <script src="//unpkg.com/vue/dist/vue.js"></script>
                    <!-- 图片上传js -->
                    <script src="//unpkg.com/element-ui@2.12.0/lib/index.js"></script>
                    <div class="layui-tab-item">
                        <!-- 广告1 -->
                        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;"></fieldset>
                        <div class="layui-form-item">
                            <label class="layui-form-label">广告1图片</label>
                            <div id="app1">
                                <el-upload :limit="1" :on-remove="handleRemove" :on-success="handleSuccess" action="/?f=api&func=upload_file" :file-list="fileList" list-type="picture-card" :auto-upload="true">
                                    <i slot="default" class="el-icon-plus"></i>
                                </el-upload>
                                <el-dialog :visible.sync="dialogVisible">
                                    <img width="100%" :src="dialogImageUrl" alt="">
                                </el-dialog>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label required">广告1链接</label>
                            <div class="layui-input-block">
                                <input type="text" name="url1" lay-verify="url" autocomplete="off" placeholder="链接地址" class="layui-input">
                            </div>
                        </div>
                        <!-- 广告2 -->
                        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;"></fieldset>
                        <div class="layui-form-item">
                            <label class="layui-form-label">广告2图片</label>
                            <div id="app2">
                                <el-upload :limit="1" :on-remove="handleRemove" :on-success="handleSuccess" action="/?f=api&func=upload_file" :file-list="fileList" list-type="picture-card" :auto-upload="true">
                                    <i slot="default" class="el-icon-plus"></i>
                                </el-upload>
                                <el-dialog :visible.sync="dialogVisible">
                                    <img width="100%" :src="dialogImageUrl" alt="">
                                </el-dialog>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label required">广告2链接</label>
                            <div class="layui-input-block">
                                <input type="text" name="url2" lay-verify="url" autocomplete="off" placeholder="链接地址" class="layui-input">
                            </div>
                        </div>
                        <!-- 广告3 -->
                        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;"></fieldset>
                        <div class="layui-form-item">
                            <label class="layui-form-label">广告3图片</label>
                            <div id="app3">
                                <el-upload :limit="1" :on-remove="handleRemove" :on-success="handleSuccess" action="/?f=api&func=upload_file" :file-list="fileList" list-type="picture-card" :auto-upload="true">
                                    <i slot="default" class="el-icon-plus"></i>
                                </el-upload>
                                <el-dialog :visible.sync="dialogVisible">
                                    <img width="100%" :src="dialogImageUrl" alt="">
                                </el-dialog>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label required">广告3链接</label>
                            <div class="layui-input-block">
                                <input type="text" name="url3" lay-verify="url" autocomplete="off" placeholder="链接地址" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <div class="layui-input-block">
                                <button class="layui-btn" lay-submit="" lay-filter="bannerBtn">保存</button>
                            </div>
                        </div>
                        <script>
                        var file1 = "";
                        var file2 = "";
                        var file3 = "";
                        </script>
                    </div>
                    <!-- 关于我们 -->
                    <div class="layui-tab-item">
                        <div class="layui-form-item">
                            <div id="editoraboutus" style="margin: 20px 0px 0px 20px">
                                <p>关于我们</p>
                            </div>
                            <button class="layui-btn" lay-submit="" lay-filter="aboutBtn">保存</button>
                        </div>
                    </div>
                    <!-- 客服中心 -->
                    <div class="layui-tab-item">
                        <div class="layui-form-item">
                            <div id="editorkefu" style="margin: 20px 0px 0px 20px">
                                <p>客服中心</p>
                            </div>
                            <button class="layui-btn" lay-submit="" lay-filter="kefuBtn">保存</button>
                        </div>
                    </div>
                    <!-- 使用规则 -->
                    <div class="layui-tab-item">
                        <div class="layui-form-item">
                            <div id="editorguize" style="margin: 20px 0px 0px 20px">
                                <p>使用规则</p>
                            </div>
                            <button class="layui-btn" lay-submit="" lay-filter="guizeBtn">保存</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
    <script src="../lib/layui-v2.5.4/layui.js" charset="utf-8"></script>
    <script src="../js/lay-config.js?v=1.0.4" charset="utf-8"></script>
    <script src="../lib/jq-module/zyupload/zyupload-1.0.0.min.js" charset="utf-8"></script>
    <script>
    layui.use(['form', 'element', 'layedit', 'layer', 'wangEditor'], function() {
        var $ = layui.jquery,
            form = layui.form,
            layer = layui.layer,
            layedit = layui.layedit,
            laydate = layui.laydate,
            wangEditor = layui.wangEditor,
            element = layui.element;

        layedit.set({
            uploadImage: {
                url: '/?f=api&func=upload_file'
            }
        });

        form.verify({
          newHotel: [
             /^[\d,，]*$/
            ,'请填入酒店ID'
          ] 
        }); 


        var aboutIndex=layedit.build('editoraboutus');
        var kefuIndex=layedit.build('editorkefu');
        var guizeIndex=layedit.build('editorguize');

        // layedit.setContent(index, content, false);
        // layedit.getContent(index)

        //wangEditor编辑器

        var editor = new wangEditor('#editor');
        editor.customConfig.uploadImgServer = "/?f=api&func=upload_file";
        editor.customConfig.uploadFileName = 'file';
        editor.customConfig.pasteFilterStyle = false;
        editor.customConfig.uploadImgMaxLength = 5;
        editor.customConfig.uploadImgHooks = {
            // 上传超时
            timeout: function(xhr, editor) {
                layer.msg('上传超时！')
            },
            // 如果服务器端返回的不是 {errno:0, data: [...]} 这种格式，可使用该配置
            customInsert: function(insertImg, result, editor) {
                console.log(result);
                if (result.code == 1) {
                    var url = result.data.url;
                    url.forEach(function(e) {
                        insertImg(e);
                    })
                } else {
                    insertImg(result.msg);
                    layer.msg(result.msg);
                }
            }
        };
        editor.customConfig.customAlert = function(info) {
            layer.msg(info);
        };
        editor.create();

        $.get("/admin/?p=index&getAboutUs=1",function(data){
            data=JSON.parse(data);
            layedit.setContent(aboutIndex, data.aboutUs, false);
        });

        $.get("/admin/?p=index&getRule=1",function(data){
            data=JSON.parse(data);
            layedit.setContent(guizeIndex, data.rule, false);
        });

        $.get("/admin/?p=index&getService=1",function(data){
            data=JSON.parse(data);
            layedit.setContent(kefuIndex, data.service, false);
        });

        $.get("/admin/?p=index&getSysInfo=1",function(data){
            data=JSON.parse(data);
            $("input[name='sitename']").val(data.sysTitle);
            $("input[name='hotCity']").val(data.hotCity);
            $("input[name='newHotel']").val(data.newHotel);
        });

        form.on('submit(aboutBtn)', function(data) {
          $.post("/admin/?p=index&updateAboutUs=1",{
                aboutUs:layedit.getContent(aboutIndex),               
            }, function(result){
                if(result==1){
                    layer.alert("更改成功", {
                        title: '成功'
                    },function (index) {
                      layer.close(index);
                    });
                    
                }else{
                    alert(result);
                }
            });
            return false;
        });
        form.on('submit(kefuBtn)', function(data) {
          $.post("/admin/?p=index&updateService=1",{
                service:layedit.getContent(kefuIndex),               
            }, function(result){
                if(result==1){
                    layer.alert("更改成功", {
                        title: '成功'
                    },function (index) {
                      layer.close(index);
                    });
                    
                }else{
                    alert(result);
                }
            });
            return false;
        });
        form.on('submit(guizeBtn)', function(data) {
          $.post("/admin/?p=index&updateRule=1",{
                rule:layedit.getContent(guizeIndex),               
            }, function(result){
                if(result==1){
                    layer.alert("更改成功", {
                        title: '成功'
                    },function (index) {
                      layer.close(index);
                    });
                    
                }else{
                    alert(result);
                }
            });
            return false;
        });
        //监听提交
        form.on('submit(setting)', function(data) {
            var sysTitle=$("input[name='sitename']").val();
            var hotCity=$("input[name='hotCity']").val().replace(/，/g, ",");
            var newHotel=$("input[name='newHotel']").val().replace(/，/g, ",");
            if(!sysTitle){
              alert("请填写系统名称");
              return false;
            }
            $.post("/admin/?p=index&updateSysInfo=1",{
                sysTitle:sysTitle,
                hotCity:hotCity,
                newHotel:newHotel
            }, function(result){
                if(result==1){
                    layer.alert("更改成功", {
                        title: '成功'
                    },function (index) {
                      layer.close(index);
                    });
                    
                }else{
                    alert(result);
                }
            });
            return false;
        });

        form.on('submit(bannerBtn)', function(data) {
            $.post("/admin/?p=index&updateBanner=1",{
                bannerPics:file1+"#"+$("input[name='url1']").val()+","+file2+"#"+$("input[name='url2']").val()+","+file3+"#"+$("input[name='url3']").val(),               
            }, function(result){
                if(result==1){
                    layer.alert("更改成功", {
                        title: '成功'
                    },function (index) {
                      layer.close(index);
                    });
                    
                }else{
                    alert(result);
                }
            });
            return false;
        });

        $.get("/admin/?p=index&getBanner=1",function(data){
            data=JSON.parse(data);
            var picsArr=data.banner.split(",");
            file1=picsArr[0].split("#")[0];
            file2=picsArr[1].split("#")[0];
            file3=picsArr[2].split("#")[0];
            $("input[name='url1']").val(picsArr[0].split("#")[1]);
            $("input[name='url2']").val(picsArr[1].split("#")[1]);
            $("input[name='url3']").val(picsArr[2].split("#")[1]);
            var Main = {
                data() {
                    return {
                        dialogImageUrl: '',
                        dialogVisible: false,
                        disabled: false,
                        fileList: [{name:"pic",url:file1}]
                    };
                },
                methods: {
                    handleRemove(file) {
                        file1="";
                        console.log(file);
                    },
                    handlePictureCardPreview(file) {
                        this.dialogImageUrl = file.url;
                        this.dialogVisible = true;
                    },
                    handleDownload(file) {
                        console.log(file);
                    },
                    handleSuccess(file) {
                        file1=file.msg;
                        console.log(file.msg);
                    }
                }
            }
            var Ctor = Vue.extend(Main)
            new Ctor().$mount('#app1')
            var Main = {
                data() {
                    return {
                        dialogImageUrl: '',
                        dialogVisible: false,
                        disabled: false,
                        fileList: [{name:"pic",url:file2}]
                    };
                },
                methods: {
                    handleRemove(file) {
                        file2="";
                        console.log(file);
                    },
                    handlePictureCardPreview(file) {
                        this.dialogImageUrl = file.url;
                        this.dialogVisible = true;
                    },
                    handleDownload(file) {
                        console.log(file);
                    },
                    handleSuccess(file) {
                        file2=file.msg;
                        console.log(file.msg);
                    }
                }
            }
            var Ctor = Vue.extend(Main)
            new Ctor().$mount('#app2')
            var Main = {
                data() {
                    return {
                        dialogImageUrl: '',
                        dialogVisible: false,
                        disabled: false,
                        fileList: [{name:"pic",url:file3}]
                    };
                },
                methods: {
                    handleRemove(file) {
                        file3="";
                        console.log(file);
                    },
                    handlePictureCardPreview(file) {
                        this.dialogImageUrl = file.url;
                        this.dialogVisible = true;
                    },
                    handleDownload(file) {
                        console.log(file);
                    },
                    handleSuccess(file) {
                        file3=file.msg;
                        console.log(file.msg);
                    }
                }
            }
            var Ctor = Vue.extend(Main)
            new Ctor().$mount('#app3')
        });

    });
    </script>
</body>

</html>