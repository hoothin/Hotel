<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>选择位置</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <style type="text/css">
        html,body{height:100%; width:100%; overflow:hidden; margin:0;
        padding:0;}
        body{
        height:100%; width:100%; overflow:hidden; margin:0;
        padding:0;
        }
        div{height:83%;}
        }
    </style>
</head>

<body>
    <div class="con">
        <iframe id="mapPage" width="100%" height="100%" src="https://apis.map.qq.com/tools/locpicker?search=1&type=1&key=DMABZ-36ZKX-LRX4F-74VNC-PJBBV-FBFUG&referer=myapp" >
        </iframe>
    </div>
    <input type="hidden" id="lat"/>
    <input type="hidden" id="lng" />
    <input type="hidden" id="poiaddress" />
    <input type="hidden" id="cityname" />
    <input type="hidden" id="poiname" />
    <input class="weui-btn login-btn" id="gb" value="提交" type="button">
<!-- <script src="layer/layer.js"></script> -->
<script src="../lib/layui-v2.5.4/layui.js" charset="utf-8"></script>
<script src="../lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
<script>
    window.addEventListener('message', function(event) { //地图监听事件
        var loc = event.data;
        if (loc && loc.module == 'locationPicker') {//赋值到input框
            $("#lat").val(loc.latlng.lat);//纬度
            $("#lng").val(loc.latlng.lng);//经度
            $("#poiaddress").val(loc.poiaddress);//详细地址
            $("#cityname").val(loc.cityname);//市
            $("#poiname").val(loc.poiname);//地址 例：XX小区 即名称
        }
    }, false);
    $(function(){
        /* $('#button').click(function(){
          var lat=$('#lat').val();
          var lng=$('#lng').val();
          $.ajax({
            type: "post",
            url: "{:U('Map/mapEdit')}",
            data: {lat:lat,lng:lng},//提交到demo.php的数据
            dataType: "json",//回调函数接收数据的数据格式
            success: function(msg){
              if(msg!='' && msg.code==200){
                  alert(msg.info.lat);
                  alert(msg.info.lng);
                  window.location.href='http://www.baidu.com';//跳转地址
              }
            },
            error:function(msg){
              console.log(msg);
            }
          });
        }); */
        $('#gb').on('click', function(){
            var poiname=$('#poiaddress').val();//获取input框的值
            var lat=$('#lat').val();
            var lng=$('#lng').val();
            parent.$("#job_address").val(poiname);//传递值到父页面
            parent.$("#lat").val(lat);
            parent.$("#lng").val(lng);
            parent.$("#formBtn").removeAttr("disabled");//解除input限制
            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
            parent.layer.close(index); //再执行关闭当前iframe窗口
          });
      });
</script>
</body>
</html>